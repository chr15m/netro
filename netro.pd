#N canvas 29 132 606 382 10;
#X obj 80 12 r \$0/master;
#X obj 80 35 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0 1
;
#X obj 156 12 inlet;
#X msg 277 50 bang;
#X obj 327 233 s \$0/tick;
#X obj 277 276 outlet;
#X obj 308 118 + 1;
#X obj 277 72 metro 100;
#X obj 277 118 f;
#N canvas 393 82 496 492 master 0;
#X obj 64 13 inlet;
#X obj 11 13 inlet;
#X obj 268 13 inlet;
#X obj 11 44 spigot 0;
#X obj 214 94 spigot 0;
#X obj 11 65 route tick request-bpm;
#X text 305 81 pass new tick requests through;
#X obj 136 198 r \$0/master-id;
#X obj 61 198 r \$0/tick;
#X obj 92 369 sel 1;
#X msg 92 396 0;
#X obj 92 417 s \$0/master;
#X obj 43 110 unpack f f f;
#N canvas 7 73 450 300 other-bpm 0;
#X obj 9 12 inlet;
#X obj 9 61 !=;
#X obj 27 36 r \$0/tick-length;
#X obj 9 160 outlet;
#X text 36 61 someone else is sending bpm changes we are not master
;
#X connect 0 0 1 0;
#X connect 1 0 3 0;
#X connect 2 0 1 1;
#X restore 244 198 pd other-bpm;
#X obj 118 220 >;
#X obj 43 219 >;
#X text 181 417 someone else is now master \, sync to them;
#X obj 11 87 t a a;
#X obj 11 440 s \$0/new-values;
#X obj 11 417 spigot 0;
#X obj 43 345 t f f;
#X obj 43 250 ||;
#X text 78 265 if the tick or the master id were greater or equal;
#X obj 43 322 ||;
#X obj 74 299 &&;
#X obj 43 272 t a a;
#X obj 214 118 t b f;
#X msg 214 139 1;
#X obj 214 160 s \$0/queue-send;
#X obj 246 139 s \$0/new-tick-length;
#X obj 268 57 s \$0/send;
#X msg 268 35 request-bpm \$1;
#X connect 0 0 3 1;
#X connect 0 0 4 1;
#X connect 1 0 3 0;
#X connect 2 0 31 0;
#X connect 3 0 5 0;
#X connect 4 0 26 0;
#X connect 5 0 17 0;
#X connect 5 1 4 0;
#X connect 7 0 14 1;
#X connect 8 0 15 1;
#X connect 9 0 10 0;
#X connect 10 0 11 0;
#X connect 12 0 15 0;
#X connect 12 1 14 0;
#X connect 12 2 13 0;
#X connect 13 0 24 1;
#X connect 14 0 21 1;
#X connect 15 0 21 0;
#X connect 17 0 19 0;
#X connect 17 1 12 0;
#X connect 19 0 18 0;
#X connect 20 0 19 1;
#X connect 20 1 9 0;
#X connect 21 0 25 0;
#X connect 23 0 20 0;
#X connect 24 0 23 1;
#X connect 25 0 23 0;
#X connect 25 1 24 0;
#X connect 26 0 27 0;
#X connect 26 1 29 0;
#X connect 27 0 28 0;
#X connect 31 0 30 0;
#X restore 18 129 pd master;
#N canvas 919 102 336 234 client 0;
#X obj 3 14 inlet;
#X obj 54 14 inlet;
#X obj 3 47 spigot;
#X obj 120 14 inlet;
#X obj 84 48 spigot;
#X obj 3 150 t a a;
#N canvas 440 131 360 452 should-update-sync 0;
#X obj 8 7 inlet;
#X obj 41 50 unpack f f f;
#X obj 75 131 > 0;
#X obj 41 175 > 0;
#X obj 56 155 r \$0/tick;
#X obj 8 28 t a a;
#X obj 141 50 r \$0/tick-length;
#X obj 120 77 != 0;
#X obj 8 280 spigot;
#X obj 41 221 ||;
#X obj 41 257 ||;
#X obj 8 304 unpack f f f;
#X obj 48 346 s \$0/master-id;
#X obj 8 369 t b f;
#X obj 8 413 s \$0/reset;
#X obj 89 325 s \$0/tick-length;
#X text 159 79 if the tick-length changes;
#X text 143 133 or there is a new master;
#X text 87 177 or we are running late;
#X text 161 375 tighten up;
#X obj 90 112 r \$0/master-id;
#X obj 35 391 s \$0/new-tick;
#X obj 76 280 r \$0/new-values;
#X connect 0 0 5 0;
#X connect 1 0 3 0;
#X connect 1 1 2 0;
#X connect 1 2 7 0;
#X connect 2 0 9 1;
#X connect 3 0 9 0;
#X connect 4 0 3 1;
#X connect 5 0 8 0;
#X connect 5 1 1 0;
#X connect 6 0 7 1;
#X connect 7 0 10 1;
#X connect 8 0 11 0;
#X connect 9 0 10 0;
#X connect 10 0 8 1;
#X connect 11 0 13 0;
#X connect 11 1 12 0;
#X connect 11 2 15 0;
#X connect 13 0 14 0;
#X connect 13 1 21 0;
#X connect 20 0 2 1;
#X connect 22 0 11 0;
#X restore 35 171 pd should-update-sync;
#N canvas 134 74 343 420 become-master 0;
#X obj 7 9 inlet;
#X obj 7 211 delay;
#X obj 54 9 loadbang;
#X obj 39 127 realtime;
#X msg 39 148 seed \$1 \, bang;
#X obj 39 169 random 2000;
#X obj 39 190 + 2000;
#X obj 7 101 t b b;
#X obj 36 315 + 1;
#X obj 25 293 r \$0/master-id;
#X obj 58 232 r \$0/master;
#X obj 58 253 == 0;
#X obj 7 336 t b f;
#X obj 39 357 s \$0/master-id;
#X obj 7 397 s \$0/master;
#X msg 7 377 1;
#X text 125 170 grab some random wait period;
#X text 96 255 ignore if we're already master;
#X text 151 378 become master;
#X obj 122 9 r \$0/master;
#X obj 122 30 change;
#X obj 122 51 sel 0;
#X text 172 31 lost master;
#X obj 7 273 spigot 1;
#X text 68 213 haven't had a refresh for random wait;
#X obj 7 315 1;
#X obj 125 193 s \$0/wait-time;
#X obj 147 105 r \$0/tick-length;
#X obj 147 127 * 5;
#X connect 0 0 7 0;
#X connect 1 0 23 0;
#X connect 2 0 7 0;
#X connect 3 0 4 0;
#X connect 4 0 5 0;
#X connect 5 0 6 0;
#X connect 6 0 1 1;
#X connect 6 0 26 0;
#X connect 7 0 1 0;
#X connect 7 1 3 1;
#X connect 8 0 25 1;
#X connect 9 0 25 1;
#X connect 10 0 11 0;
#X connect 11 0 23 1;
#X connect 12 0 15 0;
#X connect 12 1 13 0;
#X connect 15 0 14 0;
#X connect 19 0 20 0;
#X connect 20 0 21 0;
#X connect 21 0 7 0;
#X connect 23 0 25 0;
#X connect 25 0 8 0;
#X connect 25 0 12 0;
#X connect 27 0 28 0;
#X connect 28 0 6 1;
#X restore 3 195 pd become-master;
#X obj 84 146 s \$0/send;
#X msg 84 124 request-bpm \$1;
#X obj 3 68 route tick;
#X text 137 50 send bpm change request;
#X text 190 171 check new sync info;
#X text 134 195 become the new master?;
#X obj 84 70 t a a;
#X obj 111 101 s \$0/first-tick-length;
#X connect 0 0 2 0;
#X connect 1 0 2 1;
#X connect 1 0 4 1;
#X connect 2 0 10 0;
#X connect 3 0 4 0;
#X connect 4 0 14 0;
#X connect 5 0 7 0;
#X connect 5 1 6 0;
#X connect 9 0 8 0;
#X connect 10 0 5 0;
#X connect 14 0 9 0;
#X connect 14 1 15 0;
#X restore 105 128 pd client;
#X obj 90 63 == 0;
#X obj 277 8 r \$0/reset;
#X obj 337 50 r \$0/tick-length;
#N canvas 553 200 450 353 do-send-ticks 0;
#X text 95 31 if master and (queue-send or every-xth-tick);
#X obj 9 8 inlet;
#X obj 9 30 spigot 0;
#X obj 81 73 r \$0/queue-send;
#X obj 36 203 s \$0/queue-send;
#X msg 36 183 0;
#X obj 9 51 t f f;
#X obj 36 73 mod 4;
#X obj 36 94 == 0;
#X obj 9 142 spigot;
#X obj 9 163 t f b;
#X obj 9 320 s \$0/send;
#X obj 9 298 list prepend tick;
#X text 74 187 unqueue any more auto-sends;
#X obj 42 119 ||;
#X obj 81 94 t b f;
#X obj 63 53 r \$0/send-frequency;
#X obj 66 255 r \$0/tick-length;
#X obj 37 234 r \$0/master-id;
#X obj 9 277 pack f 0 f;
#X text 148 281 send a tick to clients;
#X obj 54 8 r \$0/master;
#X connect 1 0 2 0;
#X connect 2 0 6 0;
#X connect 3 0 15 0;
#X connect 5 0 4 0;
#X connect 6 0 9 0;
#X connect 6 1 7 0;
#X connect 7 0 8 0;
#X connect 8 0 14 0;
#X connect 9 0 10 0;
#X connect 10 0 19 0;
#X connect 10 1 5 0;
#X connect 12 0 11 0;
#X connect 14 0 9 1;
#X connect 15 0 14 0;
#X connect 15 1 14 1;
#X connect 16 0 7 1;
#X connect 17 0 19 2;
#X connect 18 0 19 1;
#X connect 19 0 12 0;
#X connect 21 0 2 1;
#X restore 297 255 pd do-send-ticks;
#X obj 17 251 change;
#X obj 17 229 r \$0/master;
#X obj 17 272 sel 1;
#X obj 17 343 s \$0/queue-send;
#X text 118 346 if we become master queue a send;
#X obj 295 94 r \$0/new-tick;
#N canvas 476 172 333 254 new-tick-length 0;
#X obj 12 9 inlet;
#X obj 27 61 r \$0/new-tick-length;
#X obj 39 198 s \$0/new-tick-length;
#X msg 39 177 0;
#X obj 12 135 spigot;
#X obj 12 115 f;
#X obj 27 82 t f f;
#X obj 45 114 > 0;
#X msg 12 30 bang;
#X obj 12 156 t f b;
#X obj 12 219 s \$0/tick-length;
#X text 84 91 if we have some new tick length to set;
#X text 90 171 do it on the beat;
#X connect 0 0 8 0;
#X connect 1 0 6 0;
#X connect 3 0 2 0;
#X connect 4 0 9 0;
#X connect 5 0 4 0;
#X connect 6 0 5 1;
#X connect 6 1 7 0;
#X connect 7 0 4 1;
#X connect 8 0 5 0;
#X connect 9 0 10 0;
#X connect 9 1 3 0;
#X restore 337 161 pd new-tick-length;
#X obj 277 140 t f f f f;
#X obj 433 258 r \$0/master;
#X obj 285 29 loadbang;
#X obj 433 280 outlet;
#X obj 331 278 r \$0/tick-length;
#X obj 331 299 outlet;
#X obj 17 295 t b b;
#N canvas 4 54 450 300 first-tick 0;
#X obj 7 9 inlet;
#X obj 7 71 f;
#X obj 7 93 s \$0/tick-lenth;
#X obj 54 9 r \$0/tick-length;
#X obj 54 40 r \$0/first-tick-length;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X connect 3 0 1 1;
#X connect 4 0 1 1;
#X restore 44 319 pd first-tick;
#X text 131 320 first ever tick? update tick-length;
#N canvas 788 90 450 300 init 0;
#X obj 13 13 loadbang;
#X obj 32 64 \$0;
#X obj 169 94 r \$0/tick-length;
#X obj 127 180 f;
#X obj 127 246 s \$0/tick-length;
#X obj 127 71 \$1;
#X obj 127 93 sel 0;
#X msg 32 85 \; \$1/master 0 \;;
#X obj 44 129 r \$0/master;
#X obj 44 151 sel 1;
#X msg 127 125 100;
#X obj 13 36 t b b b;
#X obj 13 181 outlet;
#X connect 0 0 11 0;
#X connect 1 0 7 0;
#X connect 2 0 3 1;
#X connect 3 0 4 0;
#X connect 5 0 6 0;
#X connect 6 0 10 0;
#X connect 6 1 3 1;
#X connect 8 0 9 0;
#X connect 9 0 3 0;
#X connect 10 0 3 0;
#X connect 11 0 12 0;
#X connect 11 1 1 0;
#X connect 11 2 5 0;
#X restore 503 9 pd init;
#X obj 512 251 r \$0/connected;
#X obj 512 293 outlet;
#X obj 496 174 s \$0/connected;
#X msg 496 153 1;
#X obj 496 131 r \$0/receive;
#X obj 512 272 change;
#N canvas 75 133 541 324 net 0;
#X obj 59 170 netsend 1;
#X obj 9 9 inlet;
#X obj 9 60 list prepend send;
#X obj 9 81 list trim;
#X obj 280 262 outlet;
#X obj 59 235 s \$0/connected;
#X obj 257 10 loadbang;
#X obj 54 9 r \$0/send;
#X obj 180 262 s \$0/receive;
#X text 334 49 always stay connected;
#X msg 59 212 0;
#X obj 59 146 spigot 0;
#X obj 257 54 metro 3000;
#X obj 257 100 spigot 1;
#X obj 257 32 delay 100;
#X obj 302 80 == 0;
#X obj 59 191 sel 0;
#X msg 257 123 connect 255.255.255.255 63876;
#X text 376 194 <- allows receive override;
#X obj 358 255 print NETRO-RECEIVE;
#X obj 318 194 list trim;
#X obj 318 170 r \$2;
#X obj 180 170 netreceive 63876 1;
#X connect 0 0 11 1;
#X connect 0 0 15 0;
#X connect 0 0 16 0;
#X connect 1 0 2 0;
#X connect 2 0 3 0;
#X connect 3 0 11 0;
#X connect 6 0 14 0;
#X connect 7 0 2 0;
#X connect 10 0 5 0;
#X connect 11 0 0 0;
#X connect 12 0 13 0;
#X connect 13 0 17 0;
#X connect 14 0 12 0;
#X connect 15 0 13 1;
#X connect 16 0 10 0;
#X connect 17 0 0 0;
#X connect 20 0 4 0;
#X connect 20 0 8 0;
#X connect 20 0 19 0;
#X connect 21 0 20 0;
#X connect 22 0 4 0;
#X connect 22 0 8 0;
#X restore 18 12 pd net;
#N canvas 2 48 450 300 links 0;
#X obj 13 15 r \$0/tick-length;
#X obj 123 15 r \$0/master;
#X obj 203 15 r \$0/connected;
#X obj 303 15 r \$0/tick;
#X obj 373 15 r \$0/rate;
#X obj 373 37 s \$2/rate;
#X obj 303 37 s \$2/tick;
#X obj 203 37 s \$2/connected;
#X obj 123 37 s \$2/master;
#X obj 13 37 s \$2/tick-length;
#X connect 0 0 9 0;
#X connect 1 0 8 0;
#X connect 2 0 7 0;
#X connect 3 0 6 0;
#X connect 4 0 5 0;
#X restore 497 337 pd links;
#X obj 327 211 pipe 0;
#X obj 316 187 r \$1/latency;
#X obj 277 233 pipe 0;
#X obj 179 57 r \$2/rate-set;
#X connect 0 0 1 0;
#X connect 1 0 9 1;
#X connect 1 0 11 0;
#X connect 2 0 10 2;
#X connect 2 0 9 2;
#X connect 3 0 7 0;
#X connect 6 0 8 1;
#X connect 7 0 8 0;
#X connect 8 0 6 0;
#X connect 8 0 22 0;
#X connect 11 0 10 1;
#X connect 12 0 3 0;
#X connect 13 0 7 1;
#X connect 15 0 17 0;
#X connect 16 0 15 0;
#X connect 17 0 28 0;
#X connect 20 0 8 1;
#X connect 22 0 42 0;
#X connect 22 1 14 0;
#X connect 22 2 40 0;
#X connect 22 3 21 0;
#X connect 23 0 25 0;
#X connect 24 0 3 0;
#X connect 26 0 27 0;
#X connect 28 0 18 0;
#X connect 28 1 29 0;
#X connect 32 0 37 0;
#X connect 35 0 34 0;
#X connect 36 0 35 0;
#X connect 37 0 33 0;
#X connect 38 0 9 0;
#X connect 38 0 10 0;
#X connect 40 0 4 0;
#X connect 41 0 40 1;
#X connect 41 0 42 1;
#X connect 42 0 5 0;
#X connect 43 0 10 2;
#X connect 43 0 9 2;
